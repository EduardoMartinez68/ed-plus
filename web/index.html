<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtrar Tabla</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }

        .btn-filter {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .btn-filter i {
            margin-right: 0.5rem;
        }

        table {
            background-color: #fff;
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background-color: #343a40;
            color: #fff;
        }

        .modal .modal-header {
            background-color: #343a40;
            color: #fff;
        }

        .modal .btn-primary {
            background-color: #343a40;
            border: none;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2 class="text-center mb-4">Filtrar Tabla</h2>

    <!-- Botón para abrir el modal -->
    <button class="btn btn-dark btn-filter" id="btnShowFilters">
        <i class="fas fa-filter"></i> Mostrar Filtros
    </button>

    <!-- Tabla -->
    <table class="table table-hover text-center mt-3" id="table-container">
        <thead>
        <tr>
            <th>Clave</th>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Comercial</th>
            <th>Actividad</th>
            <th>Compañía</th>
            <th>Total</th>
            <th>Estado</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>001</td>
            <td>2024-12-23</td>
            <td>Juan Pérez</td>
            <td>Pedro López</td>
            <td>Enviar cotización</td>
            <td>ABC Corp</td>
            <td>$1,000.00</td>
            <td>Pendiente</td>
        </tr>
        <tr>
            <td>002</td>
            <td>2024-12-22</td>
            <td>María Gómez</td>
            <td>Laura Sánchez</td>
            <td>Reunión</td>
            <td>XYZ Ltd</td>
            <td>$2,500.00</td>
            <td>Completado</td>
        </tr>
        </tbody>
    </table>

    <!-- Modal -->
    <div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="filterModalLabel">Filtros</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="filterForm">
                        <!-- Campos de filtro -->
                        <div class="mb-3">
                            <label for="filterCliente" class="form-label">Cliente</label>
                            <select class="form-select" id="filterCliente"></select>
                        </div>
                        <div class="mb-3">
                            <label for="filterComercial" class="form-label">Comercial</label>
                            <select class="form-select" id="filterComercial"></select>
                        </div>
                        <div class="mb-3">
                            <label for="filterEstado" class="form-label">Estado</label>
                            <select class="form-select" id="filterEstado"></select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="applyFilters">Aplicar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/js/all.min.js"></script>
<script>
// Función para obtener los valores únicos de una columna
function getUniqueValues(tableId, columnIndex) {
    const rows = document.querySelectorAll(`#${tableId} tbody tr`);
    const values = new Set();
    rows.forEach(row => {
        const cell = row.children[columnIndex];
        if (cell && cell.textContent.trim()) {
            values.add(cell.textContent.trim());
        }
    });
    return Array.from(values);
}

// Función para poblar los filtros dinámicamente (permitir selección múltiple)
function populateFilters(tableId, filtersConfig) {
    const filterForm = document.getElementById('filterForm');
    filterForm.innerHTML = ''; // Limpiar los filtros existentes

    // Iterar sobre la configuración de filtros y agregarlos al formulario
    filtersConfig.forEach((filter) => {
        const { columnIndex, label } = filter;

        // Crear el contenedor para el filtro
        const filterDiv = document.createElement('div');
        filterDiv.classList.add('mb-3');

        // Crear la etiqueta
        const labelElement = document.createElement('label');
        labelElement.setAttribute('for', `filter${label}`);
        labelElement.classList.add('form-label');
        labelElement.textContent = label;
        filterDiv.appendChild(labelElement);

        // Crear el select para los filtros (permitir múltiples selecciones)
        const selectElement = document.createElement('select');
        selectElement.classList.add('form-select');
        selectElement.id = `filter${label}`;
        selectElement.setAttribute('multiple', 'multiple');  // Permitir selección múltiple
        filterDiv.appendChild(selectElement);

        // Poblar las opciones del filtro
        const options = getUniqueValues(tableId, columnIndex);
        selectElement.innerHTML = ''; // Limpiar opciones
        options.forEach(option => {
            const opt = document.createElement("option");
            opt.value = option;
            opt.textContent = option;
            selectElement.appendChild(opt);
        });

        filterForm.appendChild(filterDiv);
    });
}

// Función para aplicar los filtros a la tabla (permitir múltiples valores)
function applyFilters(tableId, filtersConfig) {
    const rows = document.querySelectorAll(`#${tableId} tbody tr`);

    const filters = {};
    filtersConfig.forEach(filter => {
        const selectElement = document.getElementById(`filter${filter.label}`);
        const selectedValues = Array.from(selectElement.selectedOptions).map(option => option.value);
        filters[filter.columnIndex] = selectedValues;
    });

    rows.forEach(row => {
        let visible = true;
        filtersConfig.forEach(filter => {
            const columnValue = row.children[filter.columnIndex].textContent.trim();
            const filterValues = filters[filter.columnIndex];

            // Mostrar solo si el valor de la celda está en los valores seleccionados
            if (filterValues.length > 0 && !filterValues.includes(columnValue)) {
                visible = false;
            }
        });
        row.style.display = visible ? "" : "none";
    });
}

// Función para mostrar el modal y poblar filtros
function showFilterModal(tableId, filtersConfig) {
    populateFilters(tableId, filtersConfig);
    const modal = new bootstrap.Modal(document.getElementById("filterModal"));
    modal.show();
}

// Configuración de columnas a filtrar (puedes cambiar esta configuración según tus necesidades)
const filtersConfig = [
    { columnIndex: 2, label: 'Cliente' },
    { columnIndex: 3, label: 'Comercial' },
    { columnIndex: 7, label: 'Estado' },
];

// Mostrar modal con filtros
document.getElementById("btnShowFilters").addEventListener("click", () => {
    showFilterModal('table-container', filtersConfig);
});

// Aplicar filtros y cerrar el modal
document.getElementById("applyFilters").addEventListener("click", () => {
    applyFilters('table-container', filtersConfig);
    const modal = bootstrap.Modal.getInstance(document.getElementById("filterModal"));
    modal.hide();
});
</script>
</body>
</html>
