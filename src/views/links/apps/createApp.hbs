<style>
    :root {
        --color-ed-studio: #1649FF;
        --color-background: #f0f2f5;
        --color-white: #ffffff;
        --color-gray-light: #d9d9d9;
        --color-gray: #a0a0a0;
        --color-text: #333333;
        --color-secondary-text: #555555;
        --transition-speed: 0.3s;
    }

    .ed-studio-container {
        background-color: var(--color-white);
        padding: 50px 40px;
        border-radius: 16px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        position: relative;
    }

    .ed-studio-container h2 {
        text-align: center;
        color: var(--color-ed-studio);
        margin-bottom: 40px;
        font-weight: 600;
        font-size: 1.8em;
    }

    .ed-studio-progress-bar {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
        position: relative;
    }

    .ed-studio-progress-bar::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 5%;
        width: 90%;
        height: 4px;
        background-color: var(--color-gray-light);
        transform: translateY(-50%);
        z-index: -1;
    }

    .ed-studio-progress-step {
        width: 30px;
        height: 30px;
        background-color: var(--color-gray-light);
        border: 2px solid var(--color-gray-light);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--color-white);
        font-weight: 500;
        position: relative;
        z-index: 1;
        transition: background-color var(--transition-speed), border-color var(--transition-speed);
    }

    .ed-studio-progress-step.active {
        background-color: var(--color-ed-studio);
        border-color: var(--color-ed-studio);
        color: var(--color-white);
    }

    .ed-studio-form-step {
        display: none;
        animation: fadeInUp var(--transition-speed) ease-in-out;
    }

    .ed-studio-form-step.active {
        display: block;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .ed-studio-form-group {
        margin-bottom: 30px;
    }

    .ed-studio-form-group label {
        display: block;
        margin-bottom: 10px;
        color: var(--color-text);
        font-weight: 500;
        font-size: 1em;
    }

    .ed-studio-form-group input[type="text"],
    .ed-studio-form-group input[type="file"] {
        width: 100%;
        padding: 14px 18px;
        border: 1px solid var(--color-gray-light);
        border-radius: 8px;
        font-size: 1em;
        transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
    }

    .ed-studio-form-group input[type="text"]:focus,
    .ed-studio-form-group input[type="file"]:focus {
        border-color: var(--color-ed-studio);
        box-shadow: 0 0 8px rgba(22, 73, 255, 0.2);
        outline: none;
    }

    .ed-studio-app-types {
        display: flex;
        gap: 20px;
    }

    .ed-studio-app-type {
        flex: 1;
        border: 1px solid var(--color-gray-light);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: border-color var(--transition-speed), box-shadow var(--transition-speed), transform var(--transition-speed);
        background-color: var(--color-white);
        position: relative;
    }

    .ed-studio-app-type:hover {
        border-color: var(--color-ed-studio);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    .ed-studio-app-type.selected {
        border-color: var(--color-ed-studio);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
    }

    .ed-studio-app-type img {
        max-width: 60px;
        margin-bottom: 15px;
    }

    .ed-studio-app-type-title {
        font-weight: 600;
        color: var(--color-text);
        margin-bottom: 8px;
        font-size: 1.1em;
    }

    .ed-studio-app-type-description {
        font-size: 0.95em;
        color: var(--color-secondary-text);
    }

    .ed-studio-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }

    .ed-studio-buttons button {
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        background-color: var(--color-ed-studio);
        color: var(--color-white);
        font-size: 1em;
        cursor: pointer;
        transition: background-color var(--transition-speed), transform var(--transition-speed);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .ed-studio-buttons button:hover {
        background-color: #0e34d1;
        transform: translateY(-2px);
    }

    .ed-studio-buttons button:disabled {
        background-color: var(--color-gray-light);
        cursor: not-allowed;
        transform: none;
    }

    .ed-studio-logo-preview {
        margin-top: 15px;
        max-width: 120px;
        max-height: 120px;
        border-radius: 12px;
        object-fit: cover;
        display: none;
        border: 2px solid var(--color-gray-light);
    }

    /* Icono de carga */
    .ed-studio-spinner {
        border: 4px solid var(--color-gray-light);
        border-top: 4px solid var(--color-ed-studio);
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        display: none;
        margin-left: 10px;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Responsive */
    @media (max-width: 600px) {
        .ed-studio-app-types {
            flex-direction: column;
        }

        .ed-studio-buttons {
            flex-direction: column;
            gap: 10px;
        }

        .ed-studio-buttons button {
            width: 100%;
            justify-content: center;
        }
    }


    /**/
    .ed-studio-icon-selection {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
    }

    .ed-studio-icon-option {
        border: 2px solid transparent;
        border-radius: 10px;
        padding: 10px;
        cursor: pointer;
        transition: border-color 0.3s ease;
    }

    .ed-studio-icon-option img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 10px;
    }

    .ed-studio-icon-option.selected {
        border-color: var(--color-ed-studio);
    }

    .ed-studio-logo-preview-container {
        margin-top: 20px;
        text-align: center;
    }

    .ed-studio-logo-preview {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 10px;
        /*border: 2px solid var(--color-ed-studio);*/
        border: none;
        display: block;
    }
</style>
<br><br><br><br>
<center>
    {{#each apps}}
        <input type="hidden" value="{{name}}" class="name-apps">
    {{/each}}
    <div class="ed-studio-container">
        <h2>Crear tu App</h2>
        <hr>
        <img id="logoPreview" class="ed-studio-logo-preview"
            src="https://cdn-icons-png.flaticon.com/512/3904/3904303.png" alt="Vista previa del logo">
        <br>
        <div class="ed-studio-progress-bar">
            <div class="ed-studio-progress-step active" aria-label="Paso 1">1</div>
            <div class="ed-studio-progress-step" aria-label="Paso 2">2</div>
            <div class="ed-studio-progress-step" aria-label="Paso 3">3</div>
        </div>

        {{#each branchFree}}
        <form id="appForm" method="post" action="/fud/{{id_companies}}/{{id}}/create-app">
        {{/each}}
            <!-- Paso 1: app name-->
            <div class="ed-studio-form-step active" id="step-1">
                <div class="ed-studio-form-group">
                    <label for="appName">Nombre de la App</label>
                    <input type="text" id="appName" name="appName" placeholder="Ingresa el nombre de tu app" required>
                </div>
                <div class="ed-studio-buttons">
                    <button type="button" id="next-1">Siguiente</button>
                </div>
            </div>

            <!-- Paso 2: select type app -->
            <div class="ed-studio-form-step" id="step-2">
                <div class="ed-studio-form-group">
                    <label>Selecciona el tipo de App</label>
                    <div class="ed-studio-app-types">
                        <div class="ed-studio-app-type" data-type="Almacenamiento">
                            <input type="radio" name="appType" value="Almacenamiento" required style="display: none;">
                            <img src="https://cdn-icons-png.flaticon.com/512/5587/5587344.png" alt="Almacenamiento">
                            <div class="ed-studio-app-type-title">Almacenamiento</div>
                            <div class="ed-studio-app-type-description">Gestiona y almacena tus datos de manera
                                eficiente.
                            </div>
                        </div>
                        <div class="ed-studio-app-type" data-type="Equipo">
                            <input type="radio" name="appType" value="Equipo" required style="display: none;">
                            <img src="https://cdn-icons-png.flaticon.com/512/3015/3015825.png" alt="Equipo">
                            <div class="ed-studio-app-type-title">Equipo</div>
                            <div class="ed-studio-app-type-description">Colabora y coordina con tu equipo de trabajo.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ed-studio-buttons">
                    <button type="button" id="prev-2">Anterior</button>
                    <button type="button" id="next-2">Siguiente</button>
                </div>
            </div>

            <!-- Paso 3: select icon -->
            <div class="ed-studio-form-step" id="step-3">
                <div class="ed-studio-form-group">
                    <label for="appLogo">Elige el logo de tu App</label>
                    <div class="ed-studio-icon-selection">
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/3904/3904303.png" alt="Logo 1"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/6573/6573306.png" alt="Logo 1"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/256/5586/5586132.png" alt="Logo 2"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/4720/4720451.png" alt="Logo 3"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/3561/3561433.png" alt="Logo 4"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/1485/1485287.png" alt="Logo 5"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/1448/1448776.png" alt="Logo 6"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/3904/3904303.png" alt="Logo 1"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/6573/6573306.png" alt="Logo 1"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/256/5586/5586132.png" alt="Logo 2"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/4720/4720451.png" alt="Logo 3"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/3561/3561433.png" alt="Logo 4"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/1485/1485287.png" alt="Logo 5"
                                class="ed-studio-logo-option">
                        </div>
                        <div class="ed-studio-icon-option">
                            <img src="https://cdn-icons-png.flaticon.com/512/1448/1448776.png" alt="Logo 6"
                                class="ed-studio-logo-option">
                        </div>
                    </div>
                    <!-- Input hidden to store the selected logo -->
                    <input type="hidden" id="selectedLogo" name="selectedLogo" value="">

                    <!-- Preview of the selected logo -->
                    <div class="ed-studio-logo-preview-container">

                    </div>
                </div>
                <div class="ed-studio-buttons">
                    <button type="button" id="prev-3">Anterior</button>
                    <button type="submit">Crear</button>
                </div>
            </div>
        </form>
    </div>
</center>

<script>
    // Manejo de los pasos del formulario
    const form = document.getElementById('appForm');
    const steps = document.querySelectorAll('.ed-studio-form-step');
    const progressSteps = document.querySelectorAll('.ed-studio-progress-step');
    let currentStep = 0;

    const next1 = document.getElementById('next-1');
    const next2 = document.getElementById('next-2');
    const prev2 = document.getElementById('prev-2');
    const prev3 = document.getElementById('prev-3');

    next1.addEventListener('click', () => {
        const appName = document.getElementById('appName').value.trim();
        if (appName === "") {
            warningMessage('Mucho Ojo 👁️', "Por favor, ingresa el nombre de la App.");
            return;
        }

        if(this_app_exists(appName)){
            warningMessage('Ubs! 🤔', "Esta app ya existe en tu inventario");
            return;
        }

        goToStep(1);
    });

    function this_app_exists(appName) {
        // get all the inputs with the class "name-apps"
        const apps = document.querySelectorAll('.name-apps');

        //Use the some method to check if any of the inputs have the desired value
        return Array.from(apps).some(input => input.value.trim().toLowerCase() === appName.trim().toLowerCase());
    }

    next2.addEventListener('click', () => {
        const selectedType = document.querySelector('input[name="appType"]:checked');
        if (!selectedType) {
            warningMessage('Mucho Ojo 👁️', "Por favor, selecciona un tipo de App.");
            return;
        }
        goToStep(2);
    });

    prev2.addEventListener('click', () => {
        goToStep(0);
    });

    prev3.addEventListener('click', () => {
        goToStep(1);
    });

    function goToStep(step) {
        steps[currentStep].classList.remove('active');
        progressSteps[currentStep].classList.remove('active');
        steps[step].classList.add('active');
        progressSteps[step].classList.add('active');
        currentStep = step;
    }

    // Manejo de selección de tipo de App
    const appTypes = document.querySelectorAll('.ed-studio-app-type');
    appTypes.forEach(type => {
        type.addEventListener('click', () => {
            appTypes.forEach(t => t.classList.remove('selected'));
            type.classList.add('selected');
            type.querySelector('input').checked = true;
        });
    });

    // Manejo de envío del formulario
    /*
    form.addEventListener('submit', function (e) {
        e.preventDefault();
        // Mostrar spinner mientras se procesa el formulario
        const submitButton = form.querySelector('button[type="submit"]');
        const spinner = document.createElement('div');
        spinner.classList.add('ed-studio-spinner');
        submitButton.appendChild(spinner);
        spinner.style.display = 'block';
        submitButton.disabled = true;

        // Simulación de envío (reemplazar con lógica real)
        setTimeout(() => {
            alert("¡App creada exitosamente!");
            form.reset();
            logoPreview.style.display = 'none';
            // Resetear la selección de tipo de app
            appTypes.forEach(t => t.classList.remove('selected'));
            // Resetear el indicador de progreso
            goToStep(0);
            submitButton.removeChild(spinner);
            submitButton.disabled = false;
        }, 1500);
    });*/


    /**/
    // Seleccionar todos los iconos
    const icons = document.querySelectorAll('.ed-studio-icon-option img');
    const logoPreview = document.getElementById('logoPreview');
    const selectedLogoInput = document.getElementById('selectedLogo');

    // Agregar evento a cada icono para seleccionarlo
    icons.forEach(icon => {
        icon.addEventListener('click', function () {
            // Quitar la clase 'selected' de todos los iconos
            icons.forEach(icon => icon.parentElement.classList.remove('selected'));

            // Agregar la clase 'selected' al icono clicado
            this.parentElement.classList.add('selected');

            // Mostrar la imagen seleccionada en la vista previa
            logoPreview.src = this.src;
            logoPreview.style.display = 'block';

            // Guardar el valor seleccionado en el input hidden
            selectedLogoInput.value = this.src;
        });
    });
</script>