<style>
    .dropdown-toggle-box {
        border-radius: 0.5rem;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .dropdown-header {
        cursor: pointer;
        background-color: #f8f9fa;
        padding: 0.35rem 1rem border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s ease;
    }

    .dropdown-header:hover {
        background-color: #e9ecef;
    }

    .dropdown-content {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: max-height 0.4s ease, opacity 0.4s ease;
    }

    .dropdown-content.expanded {
        max-height: 1000px;
        /* lo suficiente para mostrar el contenido */
        opacity: 1;
        padding-top: 0.8rem;
    }

    /* Opcional: animación más suave si quieres íconos que giren */
    .dropdown-header i {
        transition: transform 0.3s ease;
        margin-top: 14px;
        font-size: 1rem;
    }

    .dropdown-header i.rotated {
        transform: rotate(180deg);
    }
</style>

<div id="pop-data-facture" class="my-pop">
    <div class="my-pop-content-wrapper">
        <div class="my-pop-header">
            <h4 class="my-pop-title">Datos de Facturación</h4>
            <button class="close-btn" onclick="close_my_pop('pop-data-facture')" type="button">×</button>
        </div>    

        <div class="my-pop-content">

            <!-- Formulario de Datos de Facturación del Cliente -->
            <form class="p-4 shadow-sm rounded bg-white" style="max-width: 700px; margin: auto;">
                <!-- Datos Generales del Receptor -->
                <div class="mb-3">
                    <label for="rfc" class="form-label">RFC del Cliente *</label>
                    <input type="text" class="form-control" id="rfc" name="rfc" required>
                </div>

                <div class="mb-3">
                    <label for="name" class="form-label">Nombre o Razón Social *</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>

                <div class="mb-3">
                    {{>tickets/useCFDI}}
                </div>

                <div class="mb-3">
                    {{>cfdi/regimenFiscal}}
                </div>

                <div class="mb-3">
                    <label for="zip" class="form-label">Código Postal *</label>
                    <input type="text" class="form-control" id="taxZipCode" name="taxZipCode" required>
                </div>

                <hr class="my-4">

                <!-- Dirección del Receptor -->
                <div class="dropdown-toggle-box">
                    <div class="dropdown-header" onclick="watch_most('addressSection')">
                        <label class="mb-0 fw-semibold">Domicilio</label>
                        <i class="fi fi-rr-angle-down" id="icon-addressSection"></i>
                    </div>

                    <!-- Contenido oculto con animación -->
                    <div id="addressSection" class="dropdown-content collapsed">
                        <div class="mb-3">
                            <label for="street" class="form-label">Calle</label>
                            <input type="text" class="form-control" id="street" name="street">
                        </div>

                        <div class="row mb-3">
                            <div class="col">
                                <label for="exterior" class="form-label">Número Exterior</label>
                                <input type="text" class="form-control" id="exterior" name="exterior">
                            </div>
                            <div class="col">
                                <label for="interior" class="form-label">Número Interior</label>
                                <input type="text" class="form-control" id="interior" name="interior">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="neighborhood" class="form-label">Colonia</label>
                            <input type="text" class="form-control" id="neighborhood" name="neighborhood">
                        </div>

                        <div class="row mb-3">
                            <div class="col">
                                <label for="municipality" class="form-label">Municipio</label>
                                <input type="text" class="form-control" id="municipality" name="municipality">
                            </div>
                            <div class="col">
                                <label for="state" class="form-label">Estado</label>
                                <input type="text" class="form-control" id="state" name="state">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="country" class="form-label">País</label>
                            <input type="text" class="form-control" id="country" name="country" value="México">
                        </div>
                    </div>
                </div>


                <!-- Botón de guardar -->
                <div class="d-grid mt-4">
                    <button type="button" class="btn btn-add" onclick="create_a_new_information_of_facture()">Guardar Datos</button>
                </div>
            </form>
        </div>
    </div>
</div>



<script>
    //her we will get the information of the form for after send to the server and get the answer of the server
    function get_the_information_of_the_form(){
        return {
            rfc: document.getElementById('rfc').value.trim(),
            name: document.getElementById('name').value.trim(),
            usoCFDI: document.querySelector('[name="usoCFDI"]')?.value || "", 
            regimenFiscal: document.querySelector('[name="regimenFiscal"]')?.value || "",
            taxZipCode: document.getElementById('taxZipCode').value.trim(),
            street: document.getElementById('street').value.trim(),
            exterior: document.getElementById('exterior').value.trim(),
            interior: document.getElementById('interior').value.trim(),
            neighborhood: document.getElementById('neighborhood').value.trim(),
            municipality: document.getElementById('municipality').value.trim(),
            state: document.getElementById('state').value.trim(),
            country: document.getElementById('country').value.trim(),
            id_customer: document.getElementById('id_customer').value
        };
    }


    async function create_a_new_information_of_facture(){
        const dataFacture=get_the_information_of_the_form(); //her we will get all the information of the form 

        //her we will send this information to the server and get the new information of the facture 
        const answerServer=await send_data_to_server('/links/add-data-facture-customer',dataFacture)
        if(answerServer.success){

        }else{

        }
    }
</script>