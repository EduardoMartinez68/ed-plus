

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel='stylesheet'
    href='https://cdn-uicons.flaticon.com/2.6.0/uicons-regular-rounded/css/uicons-regular-rounded.css'>

  <div class="container my-5">
    <h2>Transporte de Mercancía</h2>
    {{>warehouses/tableSendTransport}}
    {{>warehouses/messagePop}}
  </div>



  <script>
    function toggleCompleto(checkbox) {

    }


    document.getElementById('busqueda').addEventListener('input', function () {
        /*
      const filtro = this.value.toLowerCase();
      const filas = document.querySelectorAll('.table tbody tr'); // Cambié aquí el selector

      filas.forEach(fila => {
        const codigo = fila.querySelector('.codigo-barras')?.textContent.toLowerCase() || '';
        fila.style.display = codigo.includes(filtro) ? '' : 'none';
      });
      */
    });


    function seleccionarTodos(masterCheckbox) {
      const checkboxes = document.querySelectorAll('.check-fila');
      checkboxes.forEach(cb => cb.checked = masterCheckbox.checked);
    }

    // Puedes usar esta función si más adelante quieres hacer una acción masiva
    function obtenerFilasSeleccionadas() {
      return Array.from(document.querySelectorAll('.check-fila:checked')).map(cb => cb.closest('tr'));
    }
  </script>

<script>

    const listProducts = [
        {
            id: 1,
            image: 'https://panoli.mx/cdn/shop/products/00750105862010L.jpg?v=1618500354',
            name: 'Producto 1',
            code: '1234567890',
            requested: 0,
            amountToSend: 0,
            stock: 10,
            salePrice: 10,
            total: 10,
        },
        {
            id: 2,
            image: 'https://panoli.mx/cdn/shop/products/00750105862010L.jpg?v=1618500354',
            name: 'Producto 2',
            code: '8783682456',
            requested: 0,
            amountToSend: 0,
            stock: 10,
            salePrice: 10,
            total: 10,
        }
    ];

    function openPopRequest(barcode) {
        document.getElementById('pop-request-overlay').style.display = 'flex';
        const producto = listProducts.find(product => product.code === barcode); //search the product by barcode

        //now we will see if exist this product in the list
        if (!producto) {
            console.error('Producto no encontrado');
            return;
        }

        //her we will update the data of the message pop with the data of the product selected
        document.getElementById('pop-request-img').src = producto.image;
        document.getElementById('pop-request-name').textContent = producto.name;
        document.getElementById('pop-request-code').textContent = producto.code;
        document.getElementById('pop-request-stock').textContent = producto.stock;
    }

    function closePopRequest() {
        document.getElementById('pop-request-overlay').style.display = 'none';
    }

    function adjustQty(amount) {
        const input = document.getElementById('pop-request-qty');
        let value = parseInt(input.value) || 0;
        value += amount;
        if (value < 0) value = 0;
        input.value = value;
    }

    function renderizarTablaCompleta() {
        const tbody = document.getElementById('tabla');
        tbody.innerHTML = ''; // Limpiar tabla

        listProducts.forEach((product, index) => {
            const tr = document.createElement('tr');
            tr.setAttribute('data-index', index); // Lo usamos luego para editar

            tr.innerHTML = `
            <td>
                <input type="checkbox" class="check-fila">
            </td>
            <td class="information-product">
                <img src="${product.image}" alt="" class="product-table-img">
                <div class="product-text">
                    <label>${product.code}</label><br>
                    <span>${product.name}</span>
                </div>
            </td>
            <td>${product.requested} pz</td>
            <td>${product.stock} pz</td>
            <td>
                <div class="input-group">
                    <button onclick="openPopRequest('${product.code}')" class="form-control text-center">${product.amountToSend}</button>
                </div>
            </td>
            <td>${product.salePrice}</td>
            <td>${product.total}</td>
            </tr>
        `;

            tbody.appendChild(tr);
        });
    }

    
    renderizarTablaCompleta();


    function actualizarFilaPorCantidad(code, nuevaCantidad) {
        // Buscar el producto por su código
        const index = listProducts.findIndex(p => p.code === code);
        if (index === -1) return;

        // Actualizar los valores en el array
        listProducts[index].amountToSend = nuevaCantidad;
        listProducts[index].total = nuevaCantidad * listProducts[index].salePrice;

        // Actualizar la fila en la tabla (sin volver a renderizar todo)
        const tbody = document.getElementById('tabla');
        const filas = tbody.querySelectorAll('tr');

        for (let fila of filas) {
            const filaIndex = parseInt(fila.getAttribute('data-index'));
            if (filaIndex === index) {
                const btnCantidad = fila.querySelector('button');
                const tdTotal = fila.querySelectorAll('td')[6]; // Última celda

                btnCantidad.textContent = nuevaCantidad;
                tdTotal.textContent = listProducts[index].total;
                break;
            }
        }
    }




    
</script>