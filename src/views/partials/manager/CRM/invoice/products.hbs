<table id="tabla-productos">
<colgroup>
    <col style="width: 15%;">
    <col style="width: 15%;">
    <col style="width: 10%;">
    <col style="width: 10%;">
    <col style="width: 5%;">
    <col style="width: 10%;">
    <col style="width: 10%;">
    <col style="width: 10%;">
    <col style="width: 10%;">
    <col style="width: 5%;">
</colgroup>
<thead>
    <tr>
        <th>Producto</th>
        <th>Descripci√≥n</th>
        <th>Cant.</th>
        <th>UdM</th>
        <th>Paquete</th>
        <th>Precio Unitario</th>
        <th>Impuestos</th>
        <th>Descuento %</th>
        <th>Subtotal</th>
        <th>Acciones</th>
    </tr>
</thead>
<tbody>
    <tr>
        <td><input type="text" name="producto" placeholder="Nombre del producto"></td>
        <td><input type="text" name="descripcion" placeholder="Descripci√≥n"></td>
        <td><input type="number" name="cantidad" oninput="calcularSubtotal(this)" placeholder="0"></td>
        <td>
            <select name="udm">
                <option value="pieza">Pieza</option>
                <option value="kilo">Kilo</option>
                <option value="litro">Litro</option>
            </select>
        </td>
        <td class="checkbox-center"><input type="checkbox" name="paquete"></td>
        <td><input type="number" name="precio_unitario" step="0.01" oninput="calcularSubtotal(this)" placeholder="0.00">
        </td>
        <td><input type="number" name="impuestos" step="0.01" oninput="calcularSubtotal(this)" placeholder="0.00">
        </td>
        <td><input type="number" name="descuento" step="0.01" oninput="calcularSubtotal(this)" placeholder="0.00">
        </td>
        <td><input type="text" name="subtotal" readonly></td>
        <td><button class="button-form delete-btn" onclick="eliminarFila(this)">üóëÔ∏è</button></td>
    </tr>
</tbody>
<tfoot>
    <tr class="total-row">
        <td colspan="8" class="total-label">Total General:</td>
        <td><input type="text" id="total-general" readonly value="0.00"></td>
        <td></td>
    </tr>
</tfoot>
</table>
<div class="controls">
    <button onclick="" class="button-form" id="modal-products-view-menu-button">Agregar Producto</button>
</div>



<script>
    function agregarFila() {
        const table = document.getElementById('tabla-productos').getElementsByTagName('tbody')[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
                <td><input type="text" name="producto" placeholder="Nombre del producto"></td>
                <td><input type="text" name="descripcion" placeholder="Descripci√≥n"></td>
                <td><input type="number" name="cantidad" oninput="calcularSubtotal(this)" placeholder="0"></td>
                <td>
                    <select name="udm">
                        <option value="pieza">Pieza</option>
                        <option value="kilo">Kilo</option>
                        <option value="litro">Litro</option>
                    </select>
                </td>
                <td class="checkbox-center"><input type="checkbox" name="paquete"></td>
                <td><input type="number" name="precio_unitario" step="0.01" oninput="calcularSubtotal(this)" placeholder="0.00"></td>
                <td><input type="number" name="impuestos" step="0.01" oninput="calcularSubtotal(this)" placeholder="0.00"></td>
                <td><input type="number" name="descuento" step="0.01" oninput="calcularSubtotal(this)" placeholder="0.00"></td>
                <td><input type="text" name="subtotal" readonly></td>
                <td><button class="button-form delete-btn" onclick="eliminarFila(this)">üóëÔ∏è</button></td>
            `;
    }

    async function eliminarFila(button) {
        if(await questionMessage('‚ö†Ô∏è Eliminar producto ‚ö†Ô∏è','¬øDeseas eliminar este producto?')){
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
            calcularTotalGeneral();
        }
    }

    function calcularSubtotal(input) {
        const row = input.parentNode.parentNode;
        const cantidad = parseFloat(row.querySelector('input[name="cantidad"]').value) || 0;
        const precio_unitario = parseFloat(row.querySelector('input[name="precio_unitario"]').value) || 0;
        const impuestos = parseFloat(row.querySelector('input[name="impuestos"]').value) || 0;
        const descuento = parseFloat(row.querySelector('input[name="descuento"]').value) || 0;
        const pricesTaxes=((impuestos*precio_unitario)/100)
        const newPrices=precio_unitario+pricesTaxes;
        const subtotal = (cantidad * newPrices) - (cantidad * newPrices * descuento / 100);
        row.querySelector('input[name="subtotal"]').value = subtotal.toFixed(2);

        calcularTotalGeneral();
        600==100
        x==15
    }

    function calcularTotalGeneral() {
        const subtotales = document.querySelectorAll('input[name="subtotal"]');
        let totalGeneral = 0;
        subtotales.forEach(subtotal => {
            totalGeneral += parseFloat(subtotal.value) || 0;
        });
        document.getElementById('total-general').value = totalGeneral.toFixed(2);
    }
</script>





<!--this is for select a product-->
<style>
    .modal-products-modal-header {
        background-color: var(--color-company);
        color: #fff;
    }

    #modal-products-menu-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
    }

    #modal-products-product-container {
        width: 90%;
        max-width: 800px;
        height: 400px;
        overflow-y: auto;
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        background-color: #fff;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .modal-products-product {
        flex: 0 0 calc(25% - 10px);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        transition: transform 0.2s, background-color 0.2s;
    }

    .modal-products-product:hover {
        transform: scale(1.05);
        background-color: #f0f0f0;
    }

    .modal-products-product img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 5px;
    }

    .modal-products-product p {
        margin: 5px 0;
        text-align: center;
        font-size: 14px;
        color: black;
    }

    #modal-products-add-button {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }

    #modal-products-add-button:hover {
        background-color: #45a049;
    }

    #modal-products-product-search {
        margin-bottom: 15px;
        width: 100%;
        max-width: 600px;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 5px;
        outline: none;
        transition: transform 0.2s ease-in-out;
    }

    #modal-products-product-search:focus {
        border-color: #007BFF;
        transform: scale(1.02);
    }
</style>



<div id="modal-products-menu-container">
    <input type="text" id="modal-products-product-search" placeholder="Buscar producto por nombre o c√≥digo...">
    <div id="modal-products-product-container">
        {{#each products}}
            <div class="modal-products-product">
                {{#if img}}
                    <img src="https://cdn-icons-png.flaticon.com/512/756/756940.png" alt="Producto 1">
                {{else}}
                    <img src="{{img}}" alt="Producto 1">
                {{/if}}
                <p>{{name}}</p>
                <p>{{barcode}}</p>
            </div>
        {{/each}}
    </div>
    <button id="modal-products-add-button" onclick="hidenMenu()">Agregar</button>
</div>


<script>
    const viewMenuButton = document.getElementById("modal-products-view-menu-button");
    const menuContainer = document.getElementById("modal-products-menu-container");
    const productSearch = document.getElementById("modal-products-product-search");
    const addButton = document.getElementById("modal-products-add-button");
    menuContainer.style.display = "none";

    let selectedProduct = null;

    // Mostrar el men√∫
    viewMenuButton.addEventListener("click", () => {
        menuContainer.style.display = "flex";
    });

    // Ocultar el men√∫ cuando se hace clic fuera
    menuContainer.addEventListener("click", (event) => {
        if (event.target === menuContainer) {
            menuContainer.style.display = "none";
        }
    });

    function hidenMenu(){
        if (selectedProduct) {
            console.log("Producto seleccionado:", selectedProduct);
            menuContainer.style.display = "none";
            productSearch.value='';
            selectedProduct=null;

            document.querySelectorAll(".modal-products-product").forEach(product => {
                product.style.display =  "flex" ;
            });

            // Restablecer los bordes de todos los productos
            document.querySelectorAll(".modal-products-product").forEach(product => {
                product.style.border = "1px solid #ddd";
            });

            agregarFila();
        } else {
            alert("Por favor, selecciona un producto primero.");
        }
    }

    // Filtrar productos
    productSearch.addEventListener("input", (e) => {
        const filter = e.target.value.toLowerCase();
        document.querySelectorAll(".modal-products-product").forEach(product => {
            const name = product.querySelector("p:nth-child(2)").textContent.toLowerCase();
            const barcode = product.querySelector("p:nth-child(3)").textContent;
            product.style.display = name.includes(filter) || barcode.includes(filter) ? "flex" : "none";
        });
    });

    // Seleccionar producto
    document.querySelectorAll(".modal-products-product").forEach(product => {
        product.addEventListener("click", () => {
            selectedProduct = {
                name: product.querySelector("p:nth-child(2)").textContent,
                barcode: product.querySelector("p:nth-child(3)").textContent
            };
            document.querySelectorAll(".modal-products-product").forEach(p => p.style.border = "1px solid #ddd");
            product.style.border = "2px solid #4CAF50";
        });
    });

</script>