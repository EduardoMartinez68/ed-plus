<head>
    <link rel="stylesheet" href="/css/addUser/addUser.css">
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-bold-straight/css/uicons-bold-straight.css'>

    <link rel="stylesheet" href="/css/addUser/addUser.css">
    <link rel="stylesheet" href="/css/report/report.css">
    </link>
    <link rel="stylesheet" href="/css/report/sales.css">
    </link>
<style>
/* Fondo oscuro */
.popup {
  display: none; 
  position: fixed; 
  z-index: 999; 
  left: 0; 
  top: 0; 
  width: 100%; 
  height: 100%; 
  background-color: rgba(0,0,0,0.5); 
}

/* Caja del popup */
.popup-content {
  background: #fff;
  border-radius: 10px;
  margin: 10% auto;
  width: 320px;
  overflow: hidden;
  box-shadow: 0px 4px 8px rgba(0,0,0,0.3);
}

/* Header azul */
.popup-header {
  background-color: var(--color-company);
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
}

/* Título del header */
.popup-header h3 {
  margin: 0;
  font-size: 18px;
}

/* Botón cerrar (X) */
.close {
  font-size: 22px;
  cursor: pointer;
}

/* Cuerpo del popup */
.popup-body {
  padding: 20px;
  text-align: center;
}

.popup-body input {
  width: 100%;
  padding: 8px;
  margin: 10px 0;
}

.popup-body button {
  background-color: var(--color-company);
  border: none;
  padding: 8px 15px;
  color: white;
  border-radius: 5px;
  cursor: pointer;
}

.popup-body button:hover {
  background-color: #0056b3;
}
</style>

</head>

<div class="container p-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-body">
                    <label><i class="fi-icon fi-sr-user"></i> Editar Cliente</label>
                    <hr>
                    <!---this is for get the data of the customer to edit-->
                    {{#each customer}}
                        <form action="/fud/{{id_companies}}/{{id}}/editCustomer" method="POST" id="myForm">
                    {{/each}}

                    <!--this is a for that when the form be send, we can see if the user is use the UI <one> or <branch>-->
                    {{#each branchFree}}
                        <input type="hidden" value="{{id}}" name="id_branch">
                    {{/each}}
                    {{#each branch}}
                        <input type="hidden" value="{{id}}" name="id_branch">
                    {{/each}}


                        <!---this is for choose the form to create-->
                        <div class="btn-group">
                            <button class="btn-select btn-active" onclick="showSection('select-1', this)" type="button"> Información Personal</button>
                            <button class="btn-select" onclick="showSection('select-2', this)" type="button"> Información Adicional</button>
                            <!---
                            <button class="btn-select" onclick="showSection('select-3', this)" type="button"> Información de Facturación</button>
                            --->
                        </div>
                        <div id="select-1" class="content-section active">
                            <hr>
                            {{#each customer}}
                                <button class="btn btn-edit" type="button" onclick="open_pop_edit_point_user('{{id}}')">Tienes <u id="points-user">{{points}}</u> puntos</button>
                            {{/each}}
                            {{>CEO/customers/formEdit1}}
                        </div>
                        <div id="select-2" class="content-section">
                            <hr>
                            {{>manager/CRM/formCustomer2Edit}}
                        </div>

                        <!--this is the button for save-->
                        <div class="content_box">
                            <br>                  
                            <div class="form-group">
                                <button class="btn btn-success btn-block" id="my-btn-from" type="submit">Guardar</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="popup" class="popup">
  <div class="popup-content">
    <div class="popup-header">
      <h3><i class="fi-icon fi-sr-usd-circle"></i> Editar puntos</h3>
      <span class="close" onclick="closePopup()">&times;</span>
    </div>
    <div class="popup-body">
      <label for="editPoints">Nuevo valor de puntos:</label>
      <input type="number" id="editPoints" min="0" step="0.01" placeholder="Ejemplo: 120.50" class="form-control">
      <button onclick="save_new_point_user()">Actualizar</button>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>












{{>updateCountry}}
<script>
    ///------------------this is for update the date for birthday
    // Assuming birthday is the value you get from the database
    const birthdayFromDB = new Date('Mon Jan 08 2024 00:00:00 GMT-0600 (Central Standard Time)');

    // Format the date to the YYYY-MM-DD format
    const year = birthdayFromDB.getFullYear();
    const month = String(birthdayFromDB.getMonth() + 1).padStart(2, '0');
    const day = String(birthdayFromDB.getDate()).padStart(2, '0');

    const formattedDate = `${year}-${month}-${day}`;

    // Assign the formatted date to the input field
    document.getElementById('birthday').value = formattedDate;
</script>


<script>
    let labelPointUser = parseFloat(document.getElementById('points-user').textContent);
    let id_customer;
    if (isNaN(labelPointUser)) {
        labelPointUser = 0;
    }
    document.getElementById('points-user').textContent = labelPointUser;


    function open_pop_edit_point_user(id){
        id_customer=id;
        let labelPointUser = parseFloat(document.getElementById('points-user').textContent);
        if (isNaN(labelPointUser)) {
            labelPointUser = 0;
        }
        document.getElementById('editPoints').value=labelPointUser;
        document.getElementById('popup').style.display = 'block';
    }

    async function save_new_point_user(){
        const newPoints=document.getElementById('editPoints').value;
        const answer=await send_data_to_server(`/links/${id_customer}/update-data-points-user`, {newPoints}, true);
        if(answer.success){
            closePopup();
            confirmationMessage('🎉 ¡Actualización Exitosa!', 'Los datos del cliente fueron actualizados correctamente.');
            document.getElementById('points-user').textContent=newPoints;
        }else{
            errorMessage('😥 Ocurrió un problema', answer.message || 'Hubo un error al actualizar tus datos. Por favor, intenta nuevamente más tarde.');
        }
    }


    function closePopup() {
        document.getElementById('popup').style.display = 'none';
    }
</script>