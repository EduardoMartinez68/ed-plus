  <style>
    .container-departaments{
      display: flex;
      height: 100vh;
    }

    .departments {
      width: 28%;
      background-color: #f1f3f5;
      border-right: 1px solid #d1d5db;
      overflow-y: auto;
      padding: 24px 16px;
    }

    .departments h2 {
      font-size: 18px;
      margin-bottom: 16px;
      color: #1f2937;
      font-weight: 600;
    }

    .departments ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .departments li {
      padding: 10px 14px;
      margin-bottom: 6px;
      background-color: #ffffff;
      border: 1px solid #dcdfe4;
      border-left: 4px solid transparent;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.1s, border-left 0.1s;
      font-size: 15px;
    }

    .departments li:hover {
      background-color: #e4e9f0;
    }

    .departments li.active {
      background-color: #dde7f5;
      border-left: 4px solid #2563eb;
      font-weight: 600;
    }

    .categories {
      flex: 1;
      padding: 30px 40px;
      background-color: #ffffff;
    }

    .categories h2 {
      margin: 0;
      font-size: 20px;
      color: #1e293b;
    }

    .categories p {
      margin-top: 6px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #6b7280;
    }

    .category-card {
      background-color: #f9fafb;
      border: 1px solid #d1d5db;
      padding: 16px 18px;
      margin-bottom: 20px;
      border-radius: 6px;
    }

    .category-card h4 {
      margin: 0 0 6px;
      font-size: 16px;
      color: #111827;
    }

    .category-card p {
      margin: 0 0 12px;
      font-size: 14px;
      color: #4b5563;
    }

    .buttons{
      display: flex;
      gap: 10px;
    }

    .buttons button {
      padding: 6px 14px;
      font-size: 13px;
      border: 1px solid transparent;
      border-radius: 4px;
      background-color: #e5e7eb;
      color: #111;
      cursor: pointer;
      transition: background-color 0.15s;
    }

    .buttons button:hover {
      background-color: #d1d5db;
    }

    .edit-btn {
      background-color: #e0ecff;
      border-color: #93c5fd;
      color: #1d4ed8;
    }

    .edit-btn:hover {
      background-color: #d0e1ff;
    }

    .delete-btn {
      background-color: #fde2e2;
      border-color: #fca5a5;
      color: #b91c1c;
    }

    .delete-btn:hover {
      background-color: #fcdada;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .departments {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #ccc;
      }

      .categories {
        padding: 20px;
      }
    }
  </style>
<div class="tab-pane fade show" id="navbar-departaments" role="tabpanel" aria-labelledby="navbar-departaments-tab">
  <div class="card">
    <div class="card-body sat-form-container">
      <label><i class="fi-icon fi-ss-department-structure"></i> Departamentos y Categorias Online</label>
      <hr>



      <div class="container-departaments">
        <div class="departments">
          <h2>Departamentos</h2>
          <div class="row">
            <div class="input-group mb-3">
              <input type="text" class="form-control" placeholder="Buscar por nombre">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="btn btn-edit" onclick="open_my_pop('addNewDepartament')">+</button>
              </div>
            </div>
          </div>
          <ul id="departmentList"></ul>
        </div>

        <div class="categories">
          <h2 id="selectedDepartmentName">Selecciona un departamento</h2>
          <p id="selectedDepartmentDescription"></p>
          
          <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Buscar categoria por nombre">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="btn btn-edit" onclick="open_my_pop('addNewCategory')">+</button>
            </div>
          </div>

          <div id="categoryList"></div>
        </div>
      </div>











    </div>
  </div>
</div>







<div id="addNewDepartament" class="my-pop">  
    <div class="my-pop-content-wrapper">
        <div class="my-pop-header">
            <h4 class="my-pop-title">Crear un nuevo departamento Online    </h4>
            <button class="close-btn" onclick="close_my_pop('addNewDepartament')" type="button">√ó</button>
        </div>  
        <div class="my-pop-content">
          <div class="form-group">
            <label for="">Nombre del departamento *</label>
            <input type="text" class="form-control" placeholder="Escribe el nombre del departamento" id="nameNewDepartament">
          </div>

          <div class="form-group">
            <label for="">Descripci√≥n</label>
            <textarea name="" id="descriptionNewDepartament" placeholder="Escribe una descripci√≥n..." class="form-control"></textarea>
          </div>

          <button class="btn btn-add" onclick="addNewCategoriaToTheServer()">Agregar</button>
        </div>
    </div>
</div>


<div id="addNewCategory" class="my-pop">  
    <div class="my-pop-content-wrapper">
        <div class="my-pop-header">
            <h4 class="my-pop-title" id="titleAddNewCategory">Crear una nueva cetegoria a    </h4>
            <button class="close-btn" onclick="close_my_pop('addNewCategory')" type="button">√ó</button>
        </div>  
        <div class="my-pop-content">
          <div class="form-group">
            <label for="">Nombre de la Categoria *</label>
            <input type="text" class="form-control" placeholder="Escribe el nombre de la categoria" id="nameCategory">
          </div>

          <div class="form-group">
            <label for="">Descripci√≥n</label>
            <textarea name=""  placeholder="Escribe una descripci√≥n..." class="form-control" id="descriptionCategory"></textarea>
          </div>

          <button class="btn btn-add" onclick="add_a_new_category_from_the_pop()">Agregar</button>
        </div>
    </div>
</div>









<script>
  const departmentList = document.getElementById('departmentList');
  const selectedDepartmentName = document.getElementById('selectedDepartmentName');
  const selectedDepartmentDescription = document.getElementById('selectedDepartmentDescription');
  const categoryList = document.getElementById('categoryList');

  let departamentos = [];

  let dataDepartamentEdit={};

  async function get_category_and_departament_from_my_api() {
    const formData = get_key_of_my_api();

    const response = await send_data_to_my_api_in_the_server(
      'https://pluspuntodeventa.com/api/branch_online/get_departaments_and_categories.php',
      formData
    );

    if (response.success && Array.isArray(response.data)) {
      departamentos = response.data;
      renderDepartments();
    } else {
      notificationMessageError('üí• ¬°Oh no!', 'Algo fall√≥ al obtener los departamentos y categor√≠as');
      console.error(response);
    }
  }

  function get_key_of_my_api() {
    const formData = new FormData();
    formData.append('token', document.getElementById('token').value);
    formData.append('user_email', localStorage.getItem('user_email'));
    formData.append('password', localStorage.getItem('user_password'));
    return formData;
  }

  function renderDepartments() {
    departmentList.innerHTML = ''; // limpia lista

    departamentos.forEach(dept => {
      const li = document.createElement('li');
      li.textContent = dept.name;
      li.classList.add('department-item');

      li.addEventListener('click', () => {
        mostrarCategorias(dept);
        document.querySelectorAll('#departmentList li').forEach(el => el.classList.remove('active'));
        li.classList.add('active');
      });

      departmentList.appendChild(li);
    });

    // Mostrar primero por defecto
    if (departamentos.length > 0) {
      mostrarCategorias(departamentos[0]);
      departmentList.querySelector('li').classList.add('active');
    }
  }

  function update_information_of_departament_to_edit(departamento){
    const name=departamento.name;
    const id=departamento.id;
     const description=departamento.description;
    return {
      id,
      name,
      description
    };
  }
  
  function mostrarCategorias(departamento) {

    //her update the information of the departament that our is edit
    dataDepartamentEdit=update_information_of_departament_to_edit(departamento);

    //update the title of the pop of the category
    document.getElementById('titleAddNewCategory').textContent=`Crear una nueva categor√≠a en '${dataDepartamentEdit.name}'`;


    //show all the departaments
    selectedDepartmentName.textContent = departamento.name;
    selectedDepartmentDescription.innerHTML = `
      <label>${departamento.description}</label>
      <div class="buttons">
        <button class="edit-btn" onclick="edit_departament()">Editar</button>
        <button class="delete-btn" onclick="delete_departament()">Eliminar</button>
      </div>
      <hr>
    `;

    categoryList.innerHTML = '';

    if (!Array.isArray(departamento.categories) || departamento.categories.length === 0) {
      categoryList.innerHTML = '<p>No hay categor√≠as para este departamento.</p>';
      return;
    }

    departamento.categories.forEach(cat => {
      const div = document.createElement('div');
      div.className = 'category-card';

      div.innerHTML = `
        <h4>${cat.name}</h4>
        <p>${cat.description}</p>
        <div class="buttons">
          <button class="edit-btn">Editar</button>
          <button class="delete-btn">Eliminar</button>
        </div>
      `;

      categoryList.appendChild(div);
    });
  }

  //load all the departament when all the HTML is load 
  window.addEventListener('DOMContentLoaded', get_category_and_departament_from_my_api);


  //-----------------------------------------
  function create_user_key(){
    //her we will get the data of his account PLUS
    const formData = new FormData();
    formData.append('token', document.getElementById('token').value);
    formData.append('user_email', localStorage.getItem('user_email'));
    formData.append('password', localStorage.getItem('user_password'));
    return formData;
  }

  function create_data_form_departament(){
    const key=create_user_key();
    key.append('id', dataDepartamentEdit.id);
    return key;
  }

  async function edit_departament(){
    const key=create_user_key();
    key.append('id', dataDepartamentEdit.id);

    
  }

  async function delete_departament(){
    const nameDepartament=dataDepartamentEdit.name;
    if(await questionMessage('üóëÔ∏è Eliminar Departamento',`¬øEst√°s seguro de eliminar el departamento '${nameDepartament}' o fue un dedazo? üò¨`)){
      const dataForm=create_data_form_departament();

      //we will see that answer the server
      const answer=await send_data_to_my_api_in_the_server('https://pluspuntodeventa.com/api/branch_online/delete_departament.php',dataForm);

      //we will see if the server can save the new category 
      if(answer.success){
        dataDepartamentEdit={} //clear the information of the departament

        //if the user can delete the departament, we will update the list of the UI
        await get_category_and_departament_from_my_api();
        confirmationMessage('Departamento eliminado üíÄ', `El departamento '${nameDepartament}' ha sido eliminado. Nunca lo olvidaremos... bueno, s√≠. üòÖ`);
      }else{
        warningMessage('üí• ¬°Oh no!',`Algo fall√≥ al eliminar el departamento... Mensaje:${answer.message} Error: ${answer.error}. `);
        console.log(answer);
      }
    }
  }


</script>
<script>



async function addNewCategoriaToTheServer(){
  //first we will get all the information of the form for know if have all the information that the server need
  const nameNewDepartament=document.getElementById('nameNewDepartament').value;
  const descriptionNewDepartament=document.getElementById('descriptionNewDepartament').value;

  //now we will see if the input have the information success
  if(this_input_have_a_value(nameNewDepartament)){
    const departament=create_a_new_departament(nameNewDepartament,descriptionNewDepartament);
    await send_information_to_the_server_for_add_a_new_deprtament(nameNewDepartament, departament);
  }else{
    //if not the user not have information save in the input of the name, we will show a message of error
    warningMessage('üòÖ Uy, casi...', 'Te faltaron algunos campos obligatorios. ¬°No lo dejes a la imaginaci√≥n del servidor!');
  }
}

function create_a_new_departament(nameNewDepartament,descriptionNewDepartament){
  //her we will get the data of his account PLUS
  const formData = new FormData();
  formData.append('token', document.getElementById('token').value);
  formData.append('user_email', localStorage.getItem('user_email'));
  formData.append('password', localStorage.getItem('user_password'));

  formData.append('name', nameNewDepartament);
  formData.append('description', descriptionNewDepartament);

  return formData;
}

function this_input_have_a_value(input){
  return input && input.trim() !== '';
}

async function send_information_to_the_server_for_add_a_new_deprtament(nameNewDepartament, departament){
  //get the information of the form for add departament
  const answer=await send_data_to_my_api_in_the_server('https://pluspuntodeventa.com/api/branch_online/add_new_departament.php', departament);
  if(answer.success){
    //clear the form of the departament
    document.getElementById('nameNewDepartament').value='';
    document.getElementById('descriptionNewDepartament').value='';

    await get_category_and_departament_from_my_api();
    close_my_pop('addNewDepartament');

    //show a message of success
    confirmationMessage('üéâ ¬°Departamento agregado!',`El departamento '${nameNewDepartament}' fue agregado con √©xito.`)
  }else{
    warningMessage('üí• ¬°Oh no!',`Algo fall√≥ al agregar el departamento... Mensaje:${answer.message} Error: ${answer.error}.`);
    console.log(answer)
  }
}

function create_new_category(nameCategory,descriptionCategory){
  //her we will get the data of his account PLUS
  const formData = new FormData();
  formData.append('token', document.getElementById('token').value);
  formData.append('user_email', localStorage.getItem('user_email'));
  formData.append('password', localStorage.getItem('user_password'));

  //save the id of the departamen that we is editing 
  const idDepartament=dataDepartamentEdit.id;
  formData.append('id_departament', idDepartament);

  //save the information of the category
  formData.append('name', nameCategory);
  formData.append('description', descriptionCategory);

  return formData;
}

async function add_a_new_category_from_the_pop(){
  //get the information of the form
  const nameCategory=document.getElementById('nameCategory').value;
  const descriptionCategory=document.getElementById('descriptionCategory').value;

  if(this_input_have_a_value(nameCategory)){
    const category=create_new_category(nameCategory,descriptionCategory);
    const answer=await send_data_to_my_api_in_the_server('https://pluspuntodeventa.com/api/branch_online/add_category.php',category);

    //we will see if the server can save the new category 
    if(answer.success){
      //if the user can add a new category, we will update the list of the UI
      await get_category_and_departament_from_my_api();

      //clear the form
      document.getElementById('nameCategory').value='';
      document.getElementById('descriptionCategory').value='';
      close_my_pop('addNewCategory');

      confirmationMessage('üéâ Categoria agregada!',`La Categoria '${nameCategory}' fue agregado con √©xito al departamento ${dataDepartamentEdit.name}.`)
    }else{
      warningMessage('üí• ¬°Oh no!',`Algo fall√≥ al agregar la categoria... Mensaje:${answer.message} Error: ${answer.error}. `);
      console.log(answer);
    }
  }else{
    //if not the user not have information save in the input of the name, we will show a message of error
    warningMessage('üòÖ Uy, casi...', 'Te faltaron algunos campos obligatorios. ¬°No lo dejes a la imaginaci√≥n del servidor!');
  }
  
}
</script>